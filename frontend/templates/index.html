{% extends "base.html" %}

{% block title %}Dashboard - Exoplanet Hunter AI{% endblock %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="text-center py-5">
        <h1 class="display-3 fw-bold mb-4">
            <i class="bi bi-telescope text-star"></i>
            Exoplanet Hunter AI
        </h1>
        <p class="lead text-muted mb-4">
            Advanced machine learning system for detecting and classifying exoplanets
            using NASA's Kepler mission data
        </p>
        <div class="d-flex justify-content-center gap-3">
            <a href="/predict" class="btn btn-primary btn-lg">
                <i class="bi bi-rocket-takeoff"></i> Start Classifying
            </a>
            <a href="/about" class="btn btn-outline-primary btn-lg">
                <i class="bi bi-info-circle"></i> Learn More
            </a>
        </div>
    </div>

    <!-- Status Badge -->
    <div class="text-center mb-5">
        <span class="badge bg-success pulse" id="apiStatus">
            <i class="bi bi-check-circle"></i> System Online
        </span>
        <button class="btn btn-warning btn-sm d-none ms-2" id="wakeButton" onclick="wakeAPI()">
            <i class="bi bi-lightning-charge"></i> Wake API
        </button>
    </div>

    <!-- Why This Exists Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card bg-gradient p-5" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(236, 72, 153, 0.15));">
                <h2 class="text-center mb-4 text-nebula">
                    <i class="bi bi-lightbulb"></i> Why Exoplanet Hunter AI Exists
                </h2>
                <div class="row g-4">
                    <div class="col-md-6">
                        <h5 class="fw-bold mb-3"><i class="bi bi-graph-up text-star"></i> The Challenge</h5>
                        <p class="text-muted">
                            NASA's Kepler mission has collected data on thousands of potential exoplanet candidates, but manually analyzing 
                            this vast dataset is time-consuming and prone to human error. Traditional methods struggle to accurately 
                            distinguish between confirmed planets, promising candidates, and false positives.
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h5 class="fw-bold mb-3"><i class="bi bi-bullseye text-nebula"></i> Our Mission</h5>
                        <p class="text-muted">
                            Exoplanet Hunter AI accelerates exoplanet discovery by automating the classification process with advanced 
                            machine learning. We help astronomers quickly identify the most promising candidates worthy of further study, 
                            potentially uncovering planets that could harbor life.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Our Solution Section -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-nebula">
                <i class="bi bi-gear"></i> Our Advanced Solution
            </h2>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-cpu fs-1 text-star"></i>
                    </div>
                    <h5 class="card-title text-center">CNN-Transformer Hybrid</h5>
                    <p class="card-text text-muted">
                        Our hybrid architecture combines convolutional neural networks for local pattern extraction 
                        with transformer attention mechanisms for capturing long-range dependencies in stellar data, 
                        achieving superior classification accuracy.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-layers fs-1 text-nebula"></i>
                    </div>
                    <h5 class="card-title text-center">Ensemble Learning</h5>
                    <p class="card-text text-muted">
                        We combine predictions from multiple models—CNN-Transformer, LightGBM, and XGBoost—using 
                        a voting classifier to ensure robust and reliable exoplanet detection across diverse scenarios.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <div class="text-center mb-3">
                        <i class="bi bi-shield-check fs-1 text-star"></i>
                    </div>
                    <h5 class="card-title text-center">Constitutional AI</h5>
                    <p class="card-text text-muted">
                        Built-in safety checks ensure scientific integrity with uncertainty quantification, explainable 
                        predictions, and automatic review flagging for ambiguous cases, maintaining high standards of reliability.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Performance Section -->
    <div class="row g-4 mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-nebula">
                <i class="bi bi-trophy"></i> Proven Performance
            </h2>
        </div>
        <div class="col-md-3">
            <div class="card text-center p-4 glow-purple">
                <i class="bi bi-bullseye fs-1 text-star mb-3"></i>
                <h3 class="fw-bold mb-2">83.55%</h3>
                <p class="text-muted mb-0">Accuracy</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center p-4 glow-cyan">
                <i class="bi bi-graph-up fs-1 text-nebula mb-3"></i>
                <h3 class="fw-bold mb-2">0.8142</h3>
                <p class="text-muted mb-0">Macro F1-Score</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center p-4 glow-purple">
                <i class="bi bi-check2-square fs-1 text-star mb-3"></i>
                <h3 class="fw-bold mb-2">0.8672</h3>
                <p class="text-muted mb-0">F1 (Confirmed)</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center p-4 glow-cyan">
                <i class="bi bi-x-circle fs-1 text-nebula mb-3"></i>
                <h3 class="fw-bold mb-2">0.8985</h3>
                <p class="text-muted mb-0">F1 (False Positive)</p>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4 mb-5">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-bar-chart"></i> Classification Performance by Class
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="bi bi-pie-chart"></i> Dataset Distribution
                    </h5>
                </div>
                <div class="card-body">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Benefits Section -->
    <div class="row mb-5">
        <div class="col-12">
            <h2 class="text-center mb-4 text-nebula">
                <i class="bi bi-stars"></i> Key Benefits
            </h2>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-speedometer2 text-star"></i> Accelerated Discovery
                    </h5>
                    <p class="text-muted mb-0">
                        Process thousands of exoplanet candidates in seconds, dramatically reducing the time from 
                        data collection to discovery and allowing astronomers to focus on the most promising targets.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-graph-up-arrow text-nebula"></i> Uncertainty Quantification
                    </h5>
                    <p class="text-muted mb-0">
                        Monte Carlo Dropout provides confidence estimates for every prediction, automatically flagging 
                        uncertain cases for human review and ensuring no potential discoveries are missed.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-eye text-star"></i> Interpretable Results
                    </h5>
                    <p class="text-muted mb-0">
                        Feature importance analysis shows which stellar parameters most influence each prediction, 
                        providing scientific insights and building trust in the AI's decision-making process.
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-database text-nebula"></i> Comprehensive Training
                    </h5>
                    <p class="text-muted mb-0">
                        Trained on NASA's complete Kepler cumulative dataset with advanced preprocessing techniques 
                        including SMOTE for class imbalance, ensuring reliable performance across all exoplanet types.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Call to Action -->
    <div class="card bg-gradient p-5 text-center mb-5" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(236, 72, 153, 0.2));">
        <h3 class="fw-bold mb-3">Ready to Discover Exoplanets?</h3>
        <p class="lead text-muted mb-4">
            Upload your stellar observation data and let our AI system classify potential exoplanet candidates 
            with state-of-the-art accuracy and reliability.
        </p>
        <a href="/predict" class="btn btn-primary btn-lg">
            <i class="bi bi-rocket-takeoff"></i> Start Classification
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const API_URL = 'https://exoplanet-hunter-ai-backend.onrender.com';
    
    // Wake API function
    function wakeAPI() {
        const wakeButton = document.getElementById('wakeButton');
        const statusBadge = document.getElementById('apiStatus');
        
        wakeButton.disabled = true;
        wakeButton.innerHTML = '<i class="bi bi-hourglass-split"></i> Waking API...';
        statusBadge.innerHTML = '<i class="bi bi-hourglass-split"></i> Waking up...';
        statusBadge.className = 'badge bg-info';
        
        // Ping the API to wake it up
        fetch(API_URL + '/api/model-stats')
            .then(response => {
                if (response.ok) {
                    statusBadge.innerHTML = '<i class="bi bi-check-circle"></i> System Online';
                    statusBadge.className = 'badge bg-success pulse';
                    wakeButton.classList.add('d-none');
                    wakeButton.disabled = false;
                    wakeButton.innerHTML = '<i class="bi bi-lightning-charge"></i> Wake API';
                } else {
                    throw new Error('API not responding');
                }
            })
            .catch(() => {
                statusBadge.innerHTML = '<i class="bi bi-exclamation-triangle"></i> API Offline';
                statusBadge.className = 'badge bg-danger';
                wakeButton.disabled = false;
                wakeButton.innerHTML = '<i class="bi bi-lightning-charge"></i> Wake API';
                wakeButton.classList.remove('d-none');
            });
    }

    // Performance Chart - Updated with correct metrics
    function createPerformanceChart() {
        const ctx = document.getElementById('performanceChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['CONFIRMED', 'CANDIDATE', 'FALSE POSITIVE'],
                datasets: [{
                    label: 'F1-Score',
                    data: [0.8672, 0.6771, 0.8985],
                    backgroundColor: [
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(251, 191, 36, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ],
                    borderColor: [
                        'rgba(34, 197, 94, 1)',
                        'rgba(251, 191, 36, 1)',
                        'rgba(239, 68, 68, 1)'
                    ],
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(10, 14, 39, 0.9)',
                        titleColor: '#e5e7eb',
                        bodyColor: '#e5e7eb',
                        borderColor: 'rgba(139, 92, 246, 0.5)',
                        borderWidth: 1,
                        padding: 12,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return 'F1-Score: ' + context.parsed.y.toFixed(4);
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 1.0,
                        grid: {
                            color: 'rgba(139, 92, 246, 0.1)'
                        },
                        ticks: {
                            color: '#9ca3af',
                            callback: value => value.toFixed(2)
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#9ca3af'
                        }
                    }
                },
                animation: {
                    duration: 2000,
                    easing: 'easeInOutQuart'
                }
            }
        });
    }

    // Distribution Chart
    function createDistributionChart() {
        const ctx = document.getElementById('distributionChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Confirmed', 'Candidate', 'False Positive'],
                datasets: [{
                    data: [35, 25, 40],
                    backgroundColor: [
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(251, 191, 36, 0.8)',
                        'rgba(239, 68, 68, 0.8)'
                    ],
                    borderColor: [
                        'rgba(34, 197, 94, 1)',
                        'rgba(251, 191, 36, 1)',
                        'rgba(239, 68, 68, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#9ca3af',
                            padding: 15,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(10, 14, 39, 0.9)',
                        titleColor: '#e5e7eb',
                        bodyColor: '#e5e7eb',
                        borderColor: 'rgba(139, 92, 246, 0.5)',
                        borderWidth: 1,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed + '%';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    animateScale: true,
                    duration: 2000
                }
            }
        });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        // Create charts
        createPerformanceChart();
        createDistributionChart();
        
        // Check API status
        fetch('/api/model-stats')
            .then(response => {
                const statusBadge = document.getElementById('apiStatus');
                const wakeButton = document.getElementById('wakeButton');
                
                if (response.ok) {
                    statusBadge.innerHTML = '<i class="bi bi-check-circle"></i> System Online';
                    statusBadge.className = 'badge bg-success pulse';
                    wakeButton.classList.add('d-none');
                } else {
                    statusBadge.innerHTML = '<i class="bi bi-exclamation-triangle"></i> API Offline';
                    statusBadge.className = 'badge bg-danger';
                    wakeButton.classList.remove('d-none');
                }
            })
            .catch(() => {
                const statusBadge = document.getElementById('apiStatus');
                const wakeButton = document.getElementById('wakeButton');
                statusBadge.innerHTML = '<i class="bi bi-exclamation-triangle"></i> API Offline';
                statusBadge.className = 'badge bg-danger';
                wakeButton.classList.remove('d-none');
            });
    });
</script>
{% endblock %}
